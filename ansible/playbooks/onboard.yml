---
- name: Onboard Employee
  hosts: local
  gather_facts: no

  vars:
    employee_name: "{{ employee_name }}"
    employee_email: "{{ employee_email }}"
    container_name: "workspace-{{ employee_name| lower | replace(' ', '-') }}"

  tasks:
    - name: Display onboarding info
      debug:
        msg: "Starting onboarding for {{ employee_name }}: {{ employee_email }}"

    - name: Check if container already exists
      ansible.builtin.shell: docker ps -a -q --filter "name=^{{ container_name }}$"
      register: existing_container
      ignore_errors: yes
      changed_when: false

    - name: Remove existing container if present 
      ansible.builtin.shell: docker rm -f {{ container_name }}
      when: existing_container.stdout != ""
      ignore_errors: yes

    - name: Create Docker container workspace
      ansible.builtin.shell: |
        docker run -d \
          --name {{ container_name }} \
          on-off-automation-workspace:latest \
          sleep infinity
      register: container_result

    - name: Display container info
      debug:
        msg: "[SUCCESS] Container created: {{ container_result.stdout[:12] }}"

    - name: Generate temporary password
      set_fact:
        temp_password: "{{ lookup('password', '/dev/null length=12 chars=ascii_letters,digits') }}"

    - name: Display creds (for demo)
      debug:
        msg: "Credentials - Username: {{ employee_email }}, Password: {{ temp_password }}"


